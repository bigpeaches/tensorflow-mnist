!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){var i=e[r][1][t];return s(i?i:t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){n(this,t),this.canvas=document.getElementById("main"),this.sub=document.getElementById("sub"),this.canvas.width=449,this.canvas.height=449,this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.initialize()}return s(t,[{key:"initialize",value:function(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,449,449),this.ctx.lineWidth=1,this.ctx.strokeRect(0,0,449,449),this.ctx.lineWidth=.05;for(var t=0;27>t;t++)this.ctx.beginPath(),this.ctx.moveTo(16*(t+1),0),this.ctx.lineTo(16*(t+1),449),this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,16*(t+1)),this.ctx.lineTo(449,16*(t+1)),this.ctx.closePath(),this.ctx.stroke()}},{key:"onMouseDown",value:function(t){this.canvas.style.cursor="default",this.drawing=!0,this.prev=this.getPosition(t.clientX,t.clientY)}},{key:"onMouseUp",value:function(){this.drawing=!1,this.drawSub()}},{key:"onMouseMove",value:function(t){if(this.drawing){var e=this.getPosition(t.clientX,t.clientY);this.ctx.lineWidth=16,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.prev.x,this.prev.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.prev=e}}},{key:"getPosition",value:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"drawSub",value:function(){var t=this.sub.getContext("2d"),e=new Image;e.onload=function(){var i=[],n=document.createElement("canvas").getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,28,28);for(var s=n.getImageData(0,0,28,28).data,o=0;28>o;o++)for(var r=0;28>r;r++){var a=4*(28*o+r);i[28*o+r]=(s[a+0]+s[a+1]+s[a+2])/3,t.fillStyle="rgb("+[s[a+0],s[a+1],s[a+2]].join(",")+")",t.fillRect(5*r,5*o,5,5)}$.ajax({url:"/api/mnist",method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(t){var e,i=0;t.result.forEach(function(n,s){t.result[s]>i&&(i=t.result[s],e=s)}),t.result.forEach(function(i,n){n===e?$("#output dd").eq(n).html($("<strong>").text(String(t.result[n]).substr(0,5))):$("#output dd").eq(n).html($("<span>").text(String(t.result[n]).substr(0,5)))})}})},e.src=this.canvas.toDataURL()}}]),t}();$(function(){var t=new o;$("#clear").click(function(){t.initialize()})})},{}]},{},[1]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZSIsInQiLCJuIiwiciIsInMiLCJvIiwidSIsImEiLCJyZXF1aXJlIiwiaSIsImYiLCJFcnJvciIsImNvZGUiLCJsIiwiZXhwb3J0cyIsImNhbGwiLCJsZW5ndGgiLDEsIm1vZHVsZSIsIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJNYWluIiwidGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzdWIiLCJ3aWR0aCIsImhlaWdodCIsImN0eCIsImdldENvbnRleHQiLCJhZGRFdmVudExpc3RlbmVyIiwib25Nb3VzZURvd24iLCJiaW5kIiwib25Nb3VzZVVwIiwib25Nb3VzZU1vdmUiLCJpbml0aWFsaXplIiwidmFsdWUiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImxpbmVXaWR0aCIsInN0cm9rZVJlY3QiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJzdHlsZSIsImN1cnNvciIsImRyYXdpbmciLCJwcmV2IiwiZ2V0UG9zaXRpb24iLCJjbGllbnRYIiwiY2xpZW50WSIsImRyYXdTdWIiLCJjdXJyIiwibGluZUNhcCIsIngiLCJ5IiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImxlZnQiLCJ0b3AiLCJpbWciLCJJbWFnZSIsIm9ubG9hZCIsImlucHV0cyIsInNtYWxsIiwiY3JlYXRlRWxlbWVudCIsImRyYXdJbWFnZSIsImRhdGEiLCJnZXRJbWFnZURhdGEiLCJqIiwiam9pbiIsIiQiLCJhamF4IiwidXJsIiwibWV0aG9kIiwiY29udGVudFR5cGUiLCJKU09OIiwic3RyaW5naWZ5Iiwic3VjY2VzcyIsIm1heCIsImhpZ2hzY29yZSIsInJlc3VsdCIsImZvckVhY2giLCJlcSIsImh0bWwiLCJ0ZXh0IiwiU3RyaW5nIiwic3Vic3RyIiwic3JjIiwidG9EYXRhVVJMIiwibWFpbiIsImNsaWNrIl0sIm1hcHBpbmdzIjoiQ0FBQSxRQUFVQSxHQUFFQyxFQUFFQyxFQUFFQyxHQUFHLFFBQVNDLEdBQUVDLEVBQUVDLEdBQUcsSUFBSUosRUFBRUcsR0FBRyxDQUFDLElBQUlKLEVBQUVJLEdBQUcsQ0FBQyxHQUFJRSxHQUFrQixrQkFBVEMsVUFBcUJBLE9BQVEsS0FBSUYsR0FBR0MsRUFBRSxNQUFPQSxHQUFFRixHQUFFLEVBQUksSUFBR0ksRUFBRSxNQUFPQSxHQUFFSixHQUFFLEVBQUksSUFBSUssR0FBRSxHQUFJQyxPQUFNLHVCQUF1Qk4sRUFBRSxJQUFLLE1BQU1LLEdBQUVFLEtBQUssbUJBQW1CRixFQUFFLEdBQUlHLEdBQUVYLEVBQUVHLElBQUlTLFdBQVliLEdBQUVJLEdBQUcsR0FBR1UsS0FBS0YsRUFBRUMsUUFBUSxTQUFTZCxHQUFHLEdBQUlFLEdBQUVELEVBQUVJLEdBQUcsR0FBR0wsRUFBRyxPQUFPSSxHQUFFRixFQUFFQSxFQUFFRixJQUFJYSxFQUFFQSxFQUFFQyxRQUFRZCxFQUFFQyxFQUFFQyxFQUFFQyxHQUFHLE1BQU9ELEdBQUVHLEdBQUdTLFFBQWtELElBQUksR0FBMUNMLEdBQWtCLGtCQUFURCxVQUFxQkEsUUFBZ0JILEVBQUUsRUFBRUEsRUFBRUYsRUFBRWEsT0FBT1gsSUFBSUQsRUFBRUQsRUFBRUUsR0FBSSxPQUFPRCxLQUFLYSxHQUFHLFNBQVNULEVBQVFVLEVBQU9KLEdBQ3ZkLFlBSUEsU0FBU0ssR0FBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FGaEgsR0FBSUMsR0FBZSxXQUFlLFFBQVNDLEdB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UUFBUSxTQUFVckcsRUFBR1MsR0FDekJBLElBQU15RixFQUNOUixFQUFFLGNBQWNZLEdBQUc3RixHQUFHOEYsS0FBS2IsRUFBRSxZQUFZYyxLQUFLQyxPQUFPbkIsRUFBS2MsT0FBTzNGLElBQUlpRyxPQUFPLEVBQUcsS0FFL0VoQixFQUFFLGNBQWNZLEdBQUc3RixHQUFHOEYsS0FBS2IsRUFBRSxVQUFVYyxLQUFLQyxPQUFPbkIsRUFBS2MsT0FBTzNGLElBQUlpRyxPQUFPLEVBQUcsV0FNakczQixFQUFJNEIsSUFBTXJFLEtBQUtDLE9BQU9xRSxnQkFJdkJ2RSxJQUdYcUQsR0FBRSxXQUNFLEdBQUltQixHQUFPLEdBQUl4RSxFQUNmcUQsR0FBRSxVQUFVb0IsTUFBTSxXQUNkRCxFQUFLekQsMkJBSUYiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxudmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG4vKmdsb2JhbCAkKi9cblxudmFyIE1haW4gPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oKSB7XG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYWluKTtcblxuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJyk7XG4gICAgICAgIHRoaXMuc3ViID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YicpO1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IDQ0OTsgLy8gMTYgKiAyOCArIDFcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gNDQ5OyAvLyAxNiAqIDI4ICsgMVxuICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMub25Nb3VzZURvd24uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm9uTW91c2VVcC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdXNlTW92ZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKE1haW4sIFt7XG4gICAgICAgIGtleTogJ2luaXRpYWxpemUnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9ICcjRkZGRkZGJztcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIDQ0OSwgNDQ5KTtcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgICAgICAgICB0aGlzLmN0eC5zdHJva2VSZWN0KDAsIDAsIDQ0OSwgNDQ5KTtcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDAuMDU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI3OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8oKGkgKyAxKSAqIDE2LCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oKGkgKyAxKSAqIDE2LCA0NDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKDAsIChpICsgMSkgKiAxNik7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKDQ0OSwgKGkgKyAxKSAqIDE2KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnb25Nb3VzZURvd24nLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZURvd24oZSkge1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnO1xuICAgICAgICAgICAgdGhpcy5kcmF3aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucHJldiA9IHRoaXMuZ2V0UG9zaXRpb24oZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdvbk1vdXNlVXAnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZVVwKCkge1xuICAgICAgICAgICAgdGhpcy5kcmF3aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRyYXdTdWIoKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnb25Nb3VzZU1vdmUnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZU1vdmUoZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZHJhd2luZykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyID0gdGhpcy5nZXRQb3NpdGlvbihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMTY7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZUNhcCA9ICdyb3VuZCc7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKHRoaXMucHJldi54LCB0aGlzLnByZXYueSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKGN1cnIueCwgY3Vyci55KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnByZXYgPSBjdXJyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdnZXRQb3NpdGlvbicsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQb3NpdGlvbihjbGllbnRYLCBjbGllbnRZKSB7XG4gICAgICAgICAgICB2YXIgcmVjdCA9IHRoaXMuY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB4OiBjbGllbnRYIC0gcmVjdC5sZWZ0LFxuICAgICAgICAgICAgICAgIHk6IGNsaWVudFkgLSByZWN0LnRvcFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZHJhd1N1YicsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3U3ViKCkge1xuICAgICAgICAgICAgdmFyIGN0eCA9IHRoaXMuc3ViLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dHMgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgc21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKS5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgICAgIHNtYWxsLmRyYXdJbWFnZShpbWcsIDAsIDAsIGltZy53aWR0aCwgaW1nLmhlaWdodCwgMCwgMCwgMjgsIDI4KTtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHNtYWxsLmdldEltYWdlRGF0YSgwLCAwLCAyOCwgMjgpLmRhdGE7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyODsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMjg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSA0ICogKGkgKiAyOCArIGopO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzW2kgKiAyOCArIGpdID0gKGRhdGFbbiArIDBdICsgZGF0YVtuICsgMV0gKyBkYXRhW24gKyAyXSkgLyAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoJyArIFtkYXRhW24gKyAwXSwgZGF0YVtuICsgMV0sIGRhdGFbbiArIDJdXS5qb2luKCcsJykgKyAnKSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoaiAqIDUsIGkgKiA1LCA1LCA1KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYXBpL21uaXN0JyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGlucHV0cyksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1heDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoaWdoc2NvcmUgPSAwLjA7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdC5mb3JFYWNoKGZ1bmN0aW9uIChlLCBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucmVzdWx0W2ldID4gaGlnaHNjb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZSA9IGRhdGEucmVzdWx0W2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXggPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAoZSwgaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI291dHB1dCBkZCcpLmVxKGkpLmh0bWwoJCgnPHN0cm9uZz4nKS50ZXh0KFN0cmluZyhkYXRhLnJlc3VsdFtpXSkuc3Vic3RyKDAsIDUpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI291dHB1dCBkZCcpLmVxKGkpLmh0bWwoJCgnPHNwYW4+JykudGV4dChTdHJpbmcoZGF0YS5yZXN1bHRbaV0pLnN1YnN0cigwLCA1KSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1nLnNyYyA9IHRoaXMuY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICB9XG4gICAgfV0pO1xuXG4gICAgcmV0dXJuIE1haW47XG59KSgpO1xuXG4kKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbWFpbiA9IG5ldyBNYWluKCk7XG4gICAgJCgnI2NsZWFyJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBtYWluLmluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pO1xuXG59LHt9XX0se30sWzFdKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
